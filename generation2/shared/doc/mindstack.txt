	
	

	
	
	
	
	show heart on client
	bond up
horse reaction to feeding

	
	
	+подбирать яблоко
+feed apple to horse




		horse
		apple
	tamed follow player
tame animals











































выбрать что делать дальше

































apple tree























+qol: fixed seed mode

+баг повторно не поднимается палка




многоместные маунты





день/ночь
	время
		фазы
			вечер
				сервер следит за временем
					сообщает наступил вечер
	затемнение картинки





поиск семян


hunger
inventory screen






	признак разворота .is_watching_left
точка руки при развороте




+лопата каменная
	+крафт из палки и камня

































	захват
	огонь 
	разные фановые атаки
сражаться с драконом


битвы структур - тд стиль


заперсистить мир хотя бы тот что с Мирой, миграции


















































+рысь


qol: индикатор наличия ошибки










multi action



























	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	+not interacted with
+починить порталы		
	
	
	
	без масштабирования - позже
+qol: клиент - рисовать ид сущностей при вкл отладчике
+qol: отладчик выводить имя сущности вверху	
	
	
	
+фан - порисовать уровень
+верблюд не должен бегать далеко	
	
	+применить на клиенте
	+хранить цвет в сущности (на примере верблюда)
+различия сущностей


	райдер смотрит куда и маунт
описать направление взгляда для сущностей.



анимация: точка райдера для каждого кадра


			где оно заполняется у пантеры?
		entity.animation==nil у феникса
	+трассировка
	+описана
+анимация феникса
	
автоматизация конвертации aseprite->png	
	
ритм анимации и музыки. мир танцует.	
	






чистить hand_slot на клиенте если вещь оттуда удалена


















+возможность закрыть крафт
	

коллизия портала - в вулкан можно войти только с угла	
	
				
			
			+локация
		+интеракт
	+портал на него
+левел вулкан


















сурвивал цепочка - сделать топором кайак
крафт у дерева
или у срубленого - рубить мышью

development wiki
	
	

	
	+react to f1
+server help screen	
	
	


	родительские впереди
	дочерние впереди
иерархия инпута:
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	мысли - выбирать о чём думать
система исследования


	когда сел на маунта
	+ездока с маунтом

				
				режим билда
			1 раз, в режиме билда
		поворот всех направо при загрузке - нет, теряем производительность (надо попиксельно)
	инфа о направлении спрайта (феникс)
	поворот предмета в руке
	+базовый
поворот



		+Entity.interact
	+2 события do_mount
+цепочка:

		
		
			+где должен был?
		+не проставился mounted_on у гуманоида
		+пытался сесть на 2, сел на 1, и не отобразилось сразу, толко после его мува видно
	+отладчик - просмотреть состояние верблюдов при наличии бага
	
	
	+где верблюд хранит инфу кто на нем? .mounted_by
+баг - сидим на двух верблюдах









































	
			+добавить в craftable инфу из чего: craftable.from
				+get item quantity function
			+где нибудь ещё? Db.remove
			+посмотреть удаление в коде поднимания- там крепится к руке.
		+удалить материалы
	обработать craft_request на сервере
				+команда на сервер скрафтить выбор craft_request
					+ui масштаб 2? да. есть ещё unscaled
				+ui координаты
			+реакция на выбор. | ui: см CraftList.set
			+предлагаем выбор
			+получаем что можно скрафтить
			+получаем все доступные вещи (в руках и рядом)
		+при нажатии с (реакция на кнопку)
+крафт готово

























next wish











	
clean log - some warns










































	
server  warn: trying to delete entity that is not presen
	
	

	
	
	
	
	
	
	
	
	
	
	
	
	



















	+result.is_item=true
+возможность взять топор в руки




+сущность Axe




		+закрыть ui
	+реакция клиента на craft_ok
			проиграть анимацию крафта на клиенте - позже
		+время крафта
	+ответить запросившему
	
	+добавить результат
	
		+добавить в craftable инфу из чего: craftable.from
			+get item quantity function
		+где нибудь ещё? Db.remove
		+посмотреть удаление в коде поднимания- там крепится к руке.
	+удалить материалы
+обработать craft_request на сервере


			
				

	+крафтим топор
+система крафта




























	if processed, ignore resular mouse_pressed
introduce mouse_pressed_ui
			
			
			Crafting_service.get_craftables_from_items(
		craft_list on server
	craftables should be tables (to store xy on client)

	process craftable click





	+block game input
craft list handle click
	
	
	
	
	+shadow
	hide
	+show
	+basic draw code
		
		
		entity\ui\craft_list.lua
	pick from list
craft ui




















































1182    [event] error:event unprocessed:do local _={
 target="login",
 code="craft_list",
 targetLogin="defaultLogin",
 craftables={
  "axe"
 },
 entity_name="Event",
 id=20
}
return _



client: process
	
	

	
	
	
	
	
	
	
	
	
	
	
	
	lights
	
	
	+decolorize / shade
	+check some samples
night	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

	
	
	
	
47810   server craft
47810   error: entity not registered in _entityByShape. shape:{
_polygon={
        area=208,
        vertices={
                [1]={
                        y=374.16847045062,
                        x=289.16865824344
                },
                [2]={
                        y=358.16847045062,
                        x=289.16865824344
                },
                [3]={
                        y=358.16847045062,
                        x=302.16865824344
                },
                [4]={
                        y=374.16847045062,
                        x=302.16865824344
                }
        },
        centroid={
                y=366.16847045062,
                x=295.66865824344
        },
        _radius=10.307764064044
},
_type="polygon",
_rotation=0
}
stack traceback:
        shared/lib/powlov/deps/debug.lua:105: in function 'log'
        shared/lib/powlov/module/collision.lua:165: in function 'getAtRect'
        entity/service/collision_service.lua:61: in function 'get_in_rect'
        entity/service/collision_service.lua:52: in function 'get_around'
        entity/service/server_service.lua:520: in function 'handler'
        shared/lib/powlov/module/net/event.lua:174: in function 'doProcessEvent'
        shared/lib/powlov/module/net/event.lua:209: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:219: in function 'process'
        shared/lib/powlov/module/net/server.lua:296: in function 'handler'
        shared/lib/powlov/module/net/server.lua:103: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:208: in function 'update'
        shared/lib/powlov/module/net/server.lua:271: in function '_serverLateUpdate'
        entity/service/server_service.lua:570: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:240: in function 'lateUpdate'
        shared/lib/powlov/pow.lua:334: in function 'update'
        main.lua:130: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'
        [string "boot.lua"]:802: in function <[string "boot.lua"]:769>
47810   [event] sending event:c:craft_list id:1239 t:login
47810   [event] skip event:c:craft_list id:1239 t:login
47820   [event] sending event:c:move id:1240 t:level
47880   apple grows
47880   drop_item:apple id:26 xy:nil,nil lvl:start
47880   [event] sending event:c:entity_added id:1241 t:level
47880   [event] skip event:c:entity_added id:1241 t:level
47940   [event] not sending event:c:move id:1242 t:level
48000   apple grows
48000   drop_item:apple id:27 xy:nil,nil lvl:start
48000   [event] sending event:c:entity_added id:1243 t:level
48000   [event] skip event:c:entity_added id:1243 t:level
48060   [event] sending event:c:move id:1244 t:level
48180   [event] sending event:c:move id:1245 t:level
48187   [event] not sending event:c:logoff id:2940 t:server
48187   [event] doProcessEvent:c:logoff id:2940 t:server
48187   [event] processing event:c:logoff id:2940 t:server full:do local _={
 target="server",
 code="logoff",
 id=2940,
 entity_name="Event",
 login="defaultLogin"
}
return _
end
48187   warn: trying to delete entity that is not present
stack traceback:
        shared/lib/powlov/deps/debug.lua:108: in function 'log'
        shared/lib/db/db.lua:232: in function 'remove'
        entity/service/server_service.lua:221: in function 'handler'
        shared/lib/powlov/module/net/event.lua:174: in function 'doProcessEvent'
        shared/lib/powlov/module/net/event.lua:209: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:219: in function 'process'
        shared/lib/powlov/module/net/server.lua:296: in function 'handler'
        shared/lib/powlov/module/net/server.lua:103: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:208: in function 'update'
        shared/lib/powlov/module/net/server.lua:271: in function '_serverLateUpdate'
        entity/service/server_service.lua:570: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:240: in function 'lateUpdate'
        shared/lib/powlov/pow.lua:334: in function 'update'
        main.lua:130: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'
        [string "boot.lua"]:802: in function <[string "boot.lua"]:769>
48187   [event] sending event:c:entity_removed id:1246 t:level	
	
	
	
	wip маркеры
почистить код
	
	
	
	
	описать(словить) случай когда не сработало
qol: сохранять последний элемент в редакторе
	
	
	
	














камеру на центр игрока



































		read from sprite+
	level size+
	+test interact - check portal code
	
	generated loater
	+hardcoded
+tent level




	solution: use 2 pc | run 1 instance
zbs bug: no breakpoint hit when 2 instances running


	поместить в новое место
	+на сервере убрать 
рефактор: player не хранится в контейнере левела. только в магическом левеле "player"















































	+трассировка добавления сущности в систему коллизии
	
			
		+точка добавления в систему коллизий
	+представлен сущностью server\entity\world\buildings\portal.lua
+коллизия с порталом вулкана


где хранить его?
клиент - поле game_state

					камера после смены левела
				>тест
			+принимать его на клиенте (onStateReceived) GameState.set(state)
		+добавлено поле player в фул стейт
	+копать от передачи стейта - команда full_state, getFullState
+хранить на сервере отдельно
+передавать отдельно, не в контейнере левела



		
		
				onStateReceived
			стек на установке стейта
		описать процесс входа
	найти место где
заполнять при входе в игру










индикатор что нечего крафтить






			игнорим события entity_added
			нужно не слать entity_added, ведь игрок ещё на старом левеле
			сейчас entity_added затем full_state
		описать порядок событий при переходе на новый
	получили событие добавления игрока в новый уроень, а находимся на старом
	
+-warn: skipping level event































	as part of Pow?
qol: offline lua bautifier










что тут происходит?
client:


258     [event] shouldSendEventFromClient:c:entity_added id:12 t:level result:false
258     [event] warn: skipping level event (probably not supposed to receive it). currentLevel=start event.level:space
stack traceback:
        shared/lib/powlov/deps/debug.lua:108: in function 'global_log'
        shared/lib/powlov/module/net/event.lua:19: in function 'log'
        shared/lib/powlov/module/net/event.lua:133: in function 'shouldSkipEvent'
        shared/lib/powlov/module/net/event.lua:202: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:217: in function 'process'
        shared/lib/powlov/module/net/client.lua:45: in function 'handler'
        shared/lib/powlov/module/net/client.lua:80: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:122: in function 'update'
        shared/lib/powlov/module/net/client.lua:175: in function 'update'
        entity/service/client_service.lua:299: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:211: in function 'update'
        shared/lib/powlov/pow.lua:329: in function 'update'
        main.lua:116: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'
        [string "boot.lua"]:802: in function <[string "boot.lua"]:769>
258     [event] skip event:c:entity_added id:12 t:level



































258     state set. level:space
Error: entity/service/game_state.lua:93: bad argument #1 to 'pairs' (table expected, got nil)
stack traceback:
        [string "boot.lua"]:777: in function <[string "boot.lua"]:773>
        [C]: in function 'pairs'
        entity/service/game_state.lua:93: in function 'getPlayer'
        shared/lib/powlov/module/net/event.lua:126: in function 'shouldSkipEvent'
        shared/lib/powlov/module/net/event.lua:202: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:217: in function 'process'
        shared/lib/powlov/module/net/client.lua:45: in function 'handler'
        shared/lib/powlov/module/net/client.lua:80: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:122: in function 'update'
        shared/lib/powlov/module/net/client.lua:175: in function 'update'
        entity/service/client_service.lua:299: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:211: in function 'update'
        shared/lib/powlov/pow.lua:329: in function 'update'
        main.lua:116: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'





























































	
	
	
	
	
			
			
			
					
					
					
					
					
				Player.gotoLevel(player,level_name)
			где он меняется у игрока?
		уровень не сменился только у рефа
	-- bug:
	controlled_entity_ref.level="start"
					
	local controlled_entity=_deref(controlled_entity_ref)
					
		if Movable.cannot_move(controlled_entity) then
	local movePlayer=function(event)
	
	_.cannot_move=function(actor)
	local is_mounting=Mountable.is_mounting(actor)
	
	is_mounting=function(rider) нет райдера
разматываем с хвоста:
			
			
			Error: entity/trait/mountable.lua:55: attempt to index local 'rider' (a nil value)
stack traceback:
        [string "boot.lua"]:777: in function '__index'
        entity/trait/mountable.lua:55: in function 'is_mounting'
        shared/entity/trait/movable.lua:135: in function 'cannot_move'
        entity/service/server_service.lua:183: in function 'handler'
        shared/lib/powlov/module/net/event.lua:172: in function 'doProcessEvent'
        shared/lib/powlov/module/net/event.lua:207: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:217: in function 'process'
        shared/lib/powlov/module/net/server.lua:296: in function 'handler'
        shared/lib/powlov/module/net/server.lua:103: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:208: in function 'update'
        shared/lib/powlov/module/net/server.lua:271: in function '_serverLateUpdate'
        entity/service/server_service.lua:572: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:240: in function 'lateUpdate'
        shared/lib/powlov/pow.lua:334: in function 'update'
        main.lua:130: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'
		после перехода на другой левел при попытке ходить:
	словить, собрать больше данных что происходит
+баг при смене левела



	
	
	
	
	
	
	
	
	
	
				+реакция на f11
			+из дебаггера по нажатии f11
			+записать в файл
			+сериализовать состояние памяти
		+полный дамп
		
		
		где хранятся данные игрока?
	описать дата структуру	
	
	
	
	
	
	
	
	
	
	
	
	
	qol: dump to file function
	
	
	
	
	
	
	
	
	
	
	
	
	
	






+дебаггер отрисовывается дважды - переименован draw в do_draw





































	+протестировать на клиенте
	
	
	как?
		DebuggerService=require("shared.entity.service.debugger_service")
		
		Entity.add(DebuggerService)
		
		DebuggerService.draw() 
		
	
	
+подключить дебаггер к серверу
	







доделать дроп вещей todo: d button to drop

	

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

	
		не вызывается
	ожидаю что очистится clear_prev_state_caches
	
	gameState _controlled_entity старый
	+лог? нет инфы.
	
	
	
		Pow.cam:setPosition(actor.x, actor.y)	
	стек камеры (изучить как она цепляется на старте):
+камера после смены левела не следует за игроком.	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	+hide move
+qol: log event filter	
	
	


			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			>get_craftables_from_items wip
		get crafting possibilities
	>react to c key
easier crafting: c scans all items, offers what to crafts
		use stick and rock to make axe
	use axe to make it
i want a boat!
what's next?





craft: generic items: stick_1 is stick,wood,fuel


	
+крафт: считать кол-во, например 2 рецепта используют один и тот же рес - не нужно



+баг - вещь не поднялась





















				+->collision.getAtRect
			which mod responsible? collision_service
		+scan items
		
		
			+receive
					2 player entities? could be, deal with it later, reser world now
				dual cmd bug
			+send command to server
		+where? player.keyPressed
crafting iteration 2










qol: zero brane copy relative path



qol: zero brane save layout with project







				-- todo: generic pickable
				entity.is_item
				if entity.entity_name=="stone_1" then
			stack: Humanoid.interact > try_pickup > 
		>pickup stick
	with axe from stick and stone
>chop a tree

	
	












































	+implement editor load
		+persist ()
		+serialize item name
	+implement editor save
	+connect editor load
		+check server save - Db.save() before pow quit
	+connect editor save - main
>qol editor persist current item





16200   apple grows
16200   drop_item:apple id:7 xy:nil,nil lvl:start
16217   try_pickup:humanoid id:4 xy:361.36,271.99 lvl:start : stone_1 id:6 xy:367.36,278.99 lvl:start
16217   not interacted with:stone_1 id:6 xy:367.36,278.99 lvl:start
16217   try_pickup:humanoid id:4 xy:361.36,271.99 lvl:start : sheep id:5 xy:339.22,265.97 lvl:start
16217   not interacted with:sheep id:5 xy:339.22,265.97 lvl:start
16217   not interacted with:tiger id:5 xy:368.34,280.48 lvl:start
16217   try_pickup:humanoid id:4 xy:361.36,271.99 lvl:start : tent id:3 xy:370.18,279.60 lvl:start
16217   not interacted with:tent id:3 xy:370.18,279.60 lvl:start
16217   gotoLevel:space from:start

	
	
	
	
	
	>why detach? should go together
16217   detach mountables from:humanoid id:4 xy:361.36,271.99 lvl:start
Error: entity/service/server_service.lua:82: assertion failed!
stack traceback:
        [string "boot.lua"]:777: in function <[string "boot.lua"]:773>
        [C]: in function 'assert'
        entity/service/server_service.lua:82: in function 'getPlayerState'
        entity/service/server_service.lua:91: in function 'getFullState'
        entity/service/server_service.lua:104: in function 'sendFullState'
        entity/player.lua:75: in function 'gotoLevel'
        entity/world/buildings/portal.lua:25: in function 'fnInteract'
        entity/service/server_service.lua:368: in function 'do_default_action'
        entity/service/server_service.lua:450: in function 'handler'
        ...
        shared/lib/powlov/module/net/server.lua:103: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:208: in function 'update'
        shared/lib/powlov/module/net/server.lua:271: in function '_serverLateUpdate'
        entity/service/server_service.lua:528: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:240: in function 'lateUpdate'
        shared/lib/powlov/pow.lua:334: in function 'update'
        main.lua:123: in function 'update'
        [string "boot.lua"]:612: i



	
dual mount bug: pinned to both
 





	>now despawn em
zobmie implement attack event later


 [string "boot.lua"]:802: in function <[string "boot.lua"]:769>
2025    error:event unprocessed:do local _={
 level="start",
 target="level",
 code="attack",
 id=571,
 damage=0.10000000000000001,
 entity_name="Event",
 actor={
  entity_name="zombie",
  level_name="start",
  id=3
 }
}


test


	




























note: avoid assert














	
	but first some basics, crafting, travel, world feeling - sounds, diversity, evolution
	source from observation, some random, from other sources/plugins.
	cycle randomly
develop character by controlling/managing thoughts











			
			
			>hotkey c
			onscreen button - later
		then use crafting menu
					+humanoid.do_pickup
				+how it get pinned to hand_slot
					+response to pickup button
				+do_pickup stack: humanoid.interact>try_pickup>do_pickup
			+bind item
					+humanoid.hand_slot=
				+where first defined?
				+humanoid.hand_slot_2
			+define second hand slot
				+hand_x_2
			+define hand2 point
		+second pickup
	+and axe into another
	+we need to pick stick in one hand
to craft an axe

	seek for 'todo: d button to drop' marker
todo: d button to drop



				+where? hmanoid.do_pickup
			+pin to hand
		+pickup stone

				









log("error: player without login")




2215    gotoLevel:space from:start



	это не должно вообще появляться на сервере
2215    error:event unprocessed:do local _={
 target="login",
 code="full_state",
 id=20,
 state={
  level={
   level={

	+it should resolve during play tests
+too much actions on space button?






	splashes
dlc




ui:
thoughts
actions



-- todo: pin on load


	display collision boxes when debugger active
			item pickup: fast clicking: collision box mismatch when fast drops during move
			





qol: server debug screen
persist item in hand



+qol: stop anytime from debugger?
+coop camel ride: server stuck











1 click play for users




		+client: pickup event-
		+server: humanoid.do_pickup
	+in humanoid.hand_slot
+store carried item

pin carried items







				+fixed:instant pickup after (return)
			+no drop
















		solutions: defer place after update | get xy on place+
	happens in editor update, but place can be called before update
	_activeItem.x=x
	_activeItem.y=y


+84777  warn: entity has no box shape (x,y,w,h):bee id:2 xy:nil,nil lvl:start
stack traceback:
        shared/lib/powlov/deps/debug.lua:107: in function 'log'
        shared/lib/powlov/module/entity/entity.lua:361: in function 'getCollisionBox'
        shared/lib/powlov/module/collision.lua:50: in function 'getEntityShape'
        shared/lib/powlov/module/collision.lua:68: in function 'add'
        entity/service/collision_service.lua:63: in function 'addEntity'
        shared/lib/powlov/module/entity/entity.lua:109:





easy crafting: reqiered items should be nearby. no inventory juggling

bug: fast space click on item



































	4239    [collision]     collisions debug_print end
	4239    [collision]     Collision.getAtEntity. Count:7 entity:humanoid id:4 xy:494.81,304.44 lvl:start
	4239    [collision]     getAtEntity collision:stone_1 id:6 xy:498.91,316.26 lvl:start
	4239    [collision]     getAtEntity collision:stick_1 id:6 xy:492.49,312.54 lvl:start
	4239    try_pickup:humanoid id:4 xy:494.81,304.44 lvl:start : stone_1 id:6 xy:498.91,316.26 lvl:start
	4239    not interacted with:stone_1 id:6 xy:498.91,316.26 lvl:start
	4239    try_pickup:humanoid id:4 xy:494.81,304.44 lvl:start : stick_1 id:6 xy:492.49,312.54 lvl:start
	4239    not interacted with:stick_1 id:6 xy:492.49,312.54 lvl:start


+bug not able to pickup anlything









+handle pin on client
+infinite loop? seems fixed





	






































		as parent-children link
		
			Pin_service
			sounds intresting
		>pin as separate entity
	concepts:
>pin one entity to another


















						pins stored in parent entity
						server pins entity, notifies clients
						client/server:
					Entity.pin(one,another,point1,point2)
				same code with mount, we pin rider to mount. need generic way to pin entities
				
				
				












interact chain























	splashes
discoveries









		in Db.level Db.get_level, Db.set_level
	+save (Db.set_level)
	
	
	
	
				+ok for now, not need init
			-- todo: this level does not contains functions, init()
		+trace
	+load
	+test
+levels should be persisted









	+!! player.controlled_entity was persisted as entity, not as reference
+wrong collision:






















	
	+client bind:
		+shared\lib\powlov\module\net\server.lua
	+server bind:
+network internet test

















	+client
	+server
+drop items (space key)













































	pickup items
player ai: randomly walk over island





+qol: load start level on server starts




























	could be custom menu
qol: file toc, clickable (entity is hard to open)
		






db: -- todo: separate iterable containers from magic

						Db.add?
					>how it came there?
				which container? player.
			backtrack
		>some weird entity trapped, no id, no name
	+log entity count
	
	+double activate fix should fix this
+bug: level dual init

+qol: debugger cursor location


+multiple walk animation stop with one start- not repr/rare





		later: by complex shapes using collision lib
		+now 1 aabb
	+define land area

	+test
+plant in:
+need a tree growing on island











































where entity sprite changed? back to idle


instant switch to idle
















































	should be set
entity_animation.state

			unset back to idle
			
			
			
				>react to player walk state
			>set entity.animation.state in smoothMove
		apply animation
		+define animation: humanoid.animation
		+paint some move frames
	sprite player_7
player move anim



animation state: unset walk

	movable.smoothMove
animation state: set walk


	
	
	
	
	
	
	
	
	
	
	

	+show all entities mode
		only debugger should receive input when open - later
		+shade background - check RL2
	+f12 opens it
+qol: ingame debugger	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
invent-a-wheel )	
	
	log
	breakpoint
reproduce



	server?
	no do_mount emit found
log do_mount emit on client


	mountable.do_mount(rider,mount,is_mounting)
	server_service do_mount
	event do_mount
stack


trace server mount/unmount code




	where it stored? local is_mounting=rider.mounted_on==nil
log mountable status change


418     onEntityAdded:camel id:9 xy:91.4214325698,73.58595894492 lvl:start
418     Registering generic entity:camel
520     onEntityAdded:dragon id:9 xy:84.6714325698,83.58595894492 lvl:start
520     Registering generic entity:dragon
547     onEntityAdded:elephant id:10 xy:74.1714325698,76.83595894492 lvl:start
567     onEntityAdded:horse id:9 xy:73.9214325698,75.58595894492 lvl:start
567     Registering generic entity:horse
673     client_service.do_mount start
673     mount references unset
797     client_service.do_mount start


797     warn: was not mounted but received unmount
stack traceback:
        shared/lib/powlov/deps/debug.lua:103: in function 'log'
        shared/entity/trait/mountable.lua:53: in function 'do_mount'
        entity/service/client_service.lua:170: in function 'handler'
        shared/lib/powlov/module/net/event.lua:153: in function 'doProcessEvent'
        shared/lib/powlov/module/net/event.lua:188: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:198: in function 'process'
        shared/lib/powlov/module/net/client.lua:45: in function 'handler'
        shared/lib/powlov/module/net/client.lua:80: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:122: in function 'update'
        shared/lib/powlov/module/net/client.lua:175: in function 'update'
        entity/service/client_service.lua:265: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:203: in function 'update'
        shared/lib/powlov/pow.lua:307: in function 'update'
        main.lua:100: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'
        [string "boot.lua"]:802: in function <[string "boot.lua"]:769>




	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	+last log message
+server: show more info

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	+inside entity update, see panther
+think animation system

		
	some open source guest star
	
	
	
			
				
				
				
		
	снять при окончании
	установить при начале ходьбы
		+entity.animation.state
	+где хранится состояние анимации?
						seems cool, no ref-deref stuff
					implement updating from dto, do not replace
				+client entity strong reference?
			+where to store animation state? service? entity.
			>detect animation state
			implement animation_service update_entity
		apply
		+define
	pantera walk
animation













































+qol: server code accessible from client? no, copy-paste works.


















































sprite sorting, get rid of flickering



pantera walk animation


+bee



	snake
animals grow








































	+fir_tree
	+birch tree
	+some flowers
	+blueberry
more vegetation from generation 1






































make character persist in the world even when controller log off




random vegetation editor item















+qol: editor: display item name to distinguish seeds















	
	+horse_white
+more stuff from gen1


























+make player ride again












































+make player move again
	



+autoload trees (and all child entities)-already



































>Player.interact not with self
	
	
	
	
	
	
	
	
+think this:
	player.controlled_entity - cached on server, shoud be stripped from dto
	
	con: stripping code, should be mastered anyway
	pro: could be fast, do not lookup every time
	
	extra: magic suffix _cache? or define server field directly. second looks more clear.

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
speed up shutdown. take profile snapshot of shutdown.	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	edible
	
	
	
	
			
				>define hand slot
			bind to hand slot
				check how it's done in mounts
			>implement interact, like with mounts
		by pressing space
	>collectable
		
	

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
qol: bring up server log to main server window
fun: server show some stats to make it look more alive
	
	
	
	
	
	
	
	
	
	
		its like regular place, like from editor,
			with extra info. think event inheritance/multievent composite
			
			
		+drop event: handle on client
		+drop event: handle on server
			spawn example(editor):editor_place_item
		drop is spawn
	+make apples fall
		-- todo: origin point for every sprite here
	position at footX, now it jumps from seed
apple tree



















	report copy folded copes only 1st line bug too
	back to the fun, juyt make game, report it to author.
qol: fix ZBS crash goto line ;206 instead of :206












	+limit amount of apple drops

































	
		+apple entity
		+define producing phase: 10, 
	+make it produce apples
	
	+load entities from subdirs
	
		+why it not here? (subdir result was not merged)
	+make it appear in editor
	position at footX, now it jumps from seed
apple tree



more nature



















































shift-click to select object



	make test: move all directions for same distance, measure time )
	log moves
	not reproduces. leave logging on.
something wrong with ms again
















qol: make app close faster


qol: ingame console



qol: enforce unique entity name (check, mb already?)


























idle animations, make world live



ai: pet want to be near friend











_      `-._     `-.     `.   \      :      /   .'     .-'     _.-'      _
 `--._     `-._    `-.    `.  `.    :    .'  .'    .-'    _.-'     _.--'
      `--._    `-._   `-.   `.  \   :   /  .'   .-'   _.-'    _.--'
`--.__     `--._   `-._  `-.  `. `. : .' .'  .-'  _.-'   _.--'     __.--'
__    `--.__    `--._  `-._ `-. `. \:/ .' .-' _.-'  _.--'    __.--'    __
  `--..__   `--.__   `--._ `-._`-.`_=_'.-'_.-' _.--'   __.--'   __..--'
--..__   `--..__  `--.__  `--._`-q(-_-)p-'_.--'  __.--'  __..--'   __..--
      ``--..__  `--..__ `--.__ `-'_) (_`-' __.--' __..--'  __..--''
...___        ``--..__ `--..__`--/__/  \--'__..--' __..--''        ___...
      ```---...___    ``--..__`_(<_   _/)_'__..--''    ___...---'''
```-----....._____```---...___(__\_\_|_/__)___...---'''_____.....-----'''






















	+_n - -- number default representation
+qol: less precise numbers in log, too much numbers now
















	just test it. later.
can we persist frame number? what lua integer limit?



+fun break - new character






qol: 1 click macro on mouse to restart server and client





	+now it does
+test when mounted should use mount movespeed






	

				+non-squared. squared  is faster, should used for comparsion, optimizations
			+squared / non squared?

			+function lume.distance(x1, y1, x2, y2, squared)
		+check libs / know ur libs
	+distance between points?
		+move chain:
		love.mousepressed
		Pow.mousePressed
		Entity.mousePressed(gameX,gameY,button,istouch)
		game _.mousePressed=function(gameX,gameY,button)
		ClientService.move(gameX,gameY)
		local event=_event.new("intent_move")
		event.target="server"
		-- calc move params here
		local responseEvent=_event.new("move")
	+duration calc (server only)
	+apply ms to ai movements
+movement speed





			
+fun: try elastic move
+return movement inertia, tune it












+fun break, add snail to test slow move speed


	+move away fro  border
+ai: something wrong with movement, it moves x or y only, stays in same place


	+put in game
	+paint
+firecamp






















			opt: do not send them to client, only send staus change (fatgued,well rested/fed)
		+send with slow update (once per sec), like entity_update event
	decrease with actions
	+decrease over time
	+define, show
		ms debuff
	when hits low
	when hits zero
		ms bonus
	when close to full
energy

	
	+elephant
	+camel
port stuff from gen1





more nature simulation





+clean / finish wip











	split player/human
play as anything


+mount camel

	mount hop has no duration
	Error: shared/entity/trait/movable.lua:93: attempt to concatenate local 'duration' (a boolean value)
	stack traceback:
					[string "boot.lua"]:777: in function '__concat'
					shared/entity/trait/movable.lua:93: in function 'move'
					shared/entity/trait/mountable.lua:72: in function 'do_mount'
					entity/service/client_service.lua:170: in function 'handler'
					shared/lib/powlov/module/net/event.lua:153: in function 'doProcessEvent'
					shared/lib/powlov/module/net/event.lua:188: in function 'processEvent'
					shared/lib/powlov/module/net/event.lua:198: in function 'process'
					shared/lib/powlov/module/net/client.lua:45: in function 'handler'
					shared/lib/powlov/module/net/client.lua:80: in function 'recv'
					shared/lib/powlov/deps/grease/grease/core.lua:122: in function 'update'
					shared/lib/powlov/module/net/client.lua:175: in function 'update'
					entity/service/client_service.lua:265: in function 'updateProc'
					shared/lib/powlov/module/entity/entity.lua:203: in function 'update'
					shared/lib/powlov/pow.lua:303: in function 'update'
					main.lua:96: in function 'update'











+Error: shared/entity/trait/mountable.lua:14: attempt to perform arithmetic on field 'mountX' (a nil value)
stack traceback:
        [string "boot.lua"]:777: in function '__add'
        shared/entity/trait/mountable.lua:14: in function '_get_rider_point'
        shared/entity/trait/mountable.lua:71: in function 'do_mount'
        entity/service/server_service.lua:411: in function 'handler'
        shared/lib/powlov/module/net/event.lua:153: in function 'doProcessEvent'
        shared/lib/powlov/module/net/event.lua:188: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:198: in function 'process'
        entity/trait/mountable.lua:38: in function 'interact'
        entity/player.lua:113: in function 'fnInteract'
        ...
        shared/lib/powlov/module/net/server.lua:101: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:208: in function 'update'
        shared/lib/powlov/module/net/server.lua:261: in function '_serverLateUpdate'
        entity/service/server_service.lua:449: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:232: in function 'lateUpdate'
        shared/lib/powlov/pow.lua:308: in function 'update'
        main.lua:143: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'



		






	camel={
		[6]={
			sprite="camel",
			id=6,
			y=-63,
			x=-28.304216234414,
			...
		}
	
	there is clamp already, but they do
+ai: do not travel off screen

+clean log









			+should receive updated entity when processed on server? no, grow may have additional effects on client
		+process do_grow on c
		
					
		+stop calling do_grow when no next phase - later, todo
		+make phase increase
		+update grow_on
		+full cycle
	+test this
	+process do_grow on server
  +tree.update_simulation
+tree grow










grow: use root point when changing sprites (origin)








	
	
vegetation from gen1	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
  task-context dynamic log channel, with current task state
	qol
	
	
	
	
	
	
	
live land : can change shape	
	
	
	make it automatically if only 1 portal
	portal can be linked to other portal
portal locations














				+level scope
			+entity\trait\growable.lua
		+check send location
		
					
				+still no do_grow
			+trace all events (comment channels.event.useConsole=false)
		no event.
				
			+debug place tree
				+was growing too fast, now uses phase
				
				
			+need active client
			fix: no level_name in level event
		+trace send
	+confirm event
	+update sprite
+process do_grow on client









skip, make it peaceful
			send attack+result event to level
		zombie perform attack
			-define collision damage
		-take damage if collision with zombie
		+zombie npc
	zombie attack anyone
			only in debug mode
		+display (text)
		+define
	hp
combat mechanics




		and make it later - fun first
	make it simple for now - stop any movement on collision
		https://github.com/kikito/bump.lua closer, slide cossision is start,
			http://hc.readthedocs.org/? it only detect collision, not resolve move
		implement is_solid
	wall
solid objects (impassable)
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	Error: shared/lib/powlov/deps/grease/grease/tcp.lua:110: calling 'accept' on bad self 
nice message when port is busy	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
find out how much time before frame number overflow
	
	
	
	
	
	
	
	
	
	
	
	
ww-based stream minigame	
	
	
	
	
	
	
	
	
	

		

		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
				+warn: action on multiple objects not implemented - use random
	+should be able to unmount when riding over another mount

			+p2 can mount p1 mounted creature
			+on server - reject mount intent
		+don't allow to mount already mounted
			
		+when picking from mutiple mounts to interact, ignore mounted
	+test multiplayer
+test mount/unmount	
		
		
			+warn in that case
		+check feet of pegasus - nil
	+story: i click ul corner of mount, expecting it to move feet point there
	+collect data 
+mount foot position - now it moves to ul corner










	+easier debug: disable easing, make movement linear
	+test with linear speed

	

server:
slow/seems legit
554     calc_move_duration. move_speed:5 distance:27.365319989538 duration:5.4730639979077
554     [move]  Movable.move:player id:3 xy:57.422298285647,50 lvl:start to:72.25,73 dur:5.4730639979077
554     [move]  smoothMove:player id:3 xy:57.422298285647,50 lvl:start to65.25,58 dur:5.4730639979077

speedhack bug
986     calc_move_duration. move_speed:5 distance:4.7762432936357 duration:0.95524865872714
986     [move]  Movable.move:player id:3 xy:65.25,58 lvl:start to:68.75,61.25 dur:0.95524865872714
986     [move]  smoothMove:player id:3 xy:65.25,58 lvl:start to61.75,46.25 dur:0.95524865872714	


client:
220     [move]  Movable.move:player id:3 xy:57.422298285647,50 lvl:start to:72.25,73 dur:5.4730639979077
220     [move]  smoothMove:player id:3 xy:57.422298285647,50 lvl:start to65.25,58 dur:5.4730639979077


656     [move]  Movable.move:player id:3 xy:65.25,58 lvl:start to:68.75,61.25 dur:0.95524865872714
656     [move]  smoothMove:player id:3 xy:65.25,58 lvl:start to61.75,46.25 dur:0.95524865872714

		+collect log
	+reproduce: click on shoulder
	
	+log calculation. surprise ) already.
	+gotcha! distance was calculated not from foot point
+bug: fast run





















		+now it stored in Movable._smooth_moving
	+detect when rider still moving to seat


		queue move?
		fast finish, move both?
		
					sit
					approach
				split mount into parts
			fine too, cancel prev command!, make later
		move player
		
			+ok, some actions require time
		+not accept move command?
	should be:
+if player moves while moving to seat, then pegasus start to move, and player not







				+yes, some moves should calc foot point, some not, like here, with sit point
			+test
		+foot adjustment?
	+calc is right, move is not?


		
		+check gen1 - same
	+y seems inverted? - no

		+_get_rider_point info:
		+mount at:
		+player at:
	+story (log this): (unlog this)
+move to seat.

















[[
gen1:

always moves mount

	if actor.mountedOn~=nil then
		movingEntityRef=actor.mountedOn

]]

			+mount leading
					+in movable.move
				+rider intent should transform to mount intent
			+rider leading
			
					+Entity.onMoved
				+read gen1
			+rider follow mount
		+move code: move both
		
			+reset server, new data
				debug coord before after
				log this move
				seems mount moves with rider
			test
		move rider to mount
		
			
			
			what now?
		unmount
	>implement mount:
	
	
	implement deref on server
	think generic way to pin one entity to another, and move together. later
mount pegasus

	
	
	
	
	
	
	



























process mouse_pressed_exclusive


>можно проще - эксклюзивный режим = если он стоит то только данная сущность слушает.
	
	
	
	описывать у сущности её приоритет
	сортировать по ним _mousePressedListeners
приоритеты mousePressed:




			
		kb
				
				
				
				
				
						
							более гибко
						можно до, определить приоритет, и блокировать остальных из ui
							проще реализовать?
						Game.mousePressed <- тут можно
					Pow.mousePressed
				love.mousepressed
			mouse stack:
		mouse click











9401    calc_move_duration. move_speed:15 distance:
>112.50610373813
duration:7.5004069158751
9401    [move]  Movable.move:player id:1 xy:81.583654049608,74 lvl:start to:91.083654049608,89.75 dur:7.5004069158751
9401    [move]  smoothMove:player id:1 xy:81.583654049608,74 lvl:start to84.083654049608,74.75 dur:7.5004069158751
		
		

			
			
		+collect log
		+steps: click lr leg corner
	+speed is different
		+10 still slow
	+feels too slow
+test movement. make pantera fast.


+add level name into reference.

	
	+test with Db.getByRef
+_deref on server
	
	+where they stored on client? in game_state
+enfity.find on client. _deref


			+read gen1
		+reverse: find_by_ref (not implemented in gen2)
		+_ref=Entity.get_reference


			+test/implment bind on server
		+bind properties mounted_on, mounted_by

	+implement deref on client
+bind properties mounted_on, mounted_by

server: drop timeouted player (i may leave them in world actually, that seems fun)
server: do not join twice, use same player object if still not dropped by timeout


			make it auto for next modules later
		+multirequire shared mountable on client
		+use mountable.do_mount to process
		
	+unprocessed code="do_mount" on client
				+Error: entity/trait/mountable.lua:20: attempt to index global 'Event' (a nil value)
				
			+emitting from mountable
				+nah, emit from everywhere you want!
			+all event emitters are in server_service
		+emit mount event
	+implement mountable
			+with unwanted server code
		+or expose for now? no, do not garbage client
					
					
					
					+which project RL2
				+try mixing. read gen -1
				-try separated
			+merge server and shared or keep separated?
			+sounds ok. see movable shared trait
		+mountable shared base module?
	+both should call Mountable.do_mount? 	try shared
+mount part: mountable trait (server+client)









+server draw something )

+got working state, commit!

	+when refactoring, do both client and server!
+entityName->entity_name unfinished refactor
+levelName-level_name

	Error: shared/entity/trait/movable.lua:49: attempt to index local 'actor' (a nil value)
stack traceback:
        [string "boot.lua"]:777: in function '__newindex'
        shared/entity/trait/movable.lua:49: in function 'move'
        entity/service/client_service.lua:87: in function 'handler'

+client crash on move

+clear log, entity tostring reports level name now







				no help, other dirs interferring. hack editor, no ugly naming!
			try rename to e
		entity folder is interferring
	make entity to appear at top of list
qol

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
		+old entity name came from save
		
		+Error: shared/lib/powlov/module/entity/entity.lua:257: attempt to concatenate local 'result'
		
+make server start again	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	



		


	+move теперь шлём на левел а не всем
+client 1 в космосе упал когда c2 start двигался
	
	
	+ивент не выполнялся на сервере
+прогружается старый стейт - пентера походила, юзаем портал, снова - она на старом месте






	+double require
+_entityByShape содержало сущности разных уровней
		
		
		
		+тут nil
	+local collisionEntity=_entityByShape[shape]
+test failed: multi portal a-b-a


	event
	{actorRef = {entity_name = "pegasus", id = 8, level_name = "start"} --[[table: 0x294c6518]], code = "move", entity_name = "Event", id = 210, 	target = "all", x = 201.37167591564, y = 680.51903374577} --[[table: 0x2943fb60]]
+error: move from start level went to space level player




+pegasus

+Error: shared/lib/powlov/module/collision.lua:188: attempt to get length of local 'result' (a nil value)
	stack traceback:
        [string "boot.lua"]:777: in function '__len'
        shared/lib/powlov/module/collision.lua:188: in function 'getAtEntity'
        entity/service/collision_service.lua:36: in function 'getEntityCollisions'
        entity/service/server_service.lua:284: in function 'handler'
        shared/lib/powlov/module/net/event.lua:149: in function 'doProcessEvent'
        shared/lib/powlov/module/net/event.lua:184: in function 'processEvent'
        shared/lib/powlov/module/net/event.lua:194: in function 'process'
        shared/lib/powlov/module/net/server.lua:295: in function 'handler'
        shared/lib/powlov/module/net/server.lua:101: in function 'recv'
        shared/lib/powlov/deps/grease/grease/core.lua:208: in function 'update'
        shared/lib/powlov/module/net/server.lua:270: in function '_serverLateUpdate'
        entity/service/server_service.lua:330: in function 'updateProc'
        shared/lib/powlov/module/entity/entity.lua:230: in function 'lateUpdate'
        shared/lib/powlov/pow.lua:306: in function 'update'
        main.lua:100: in function 'update'
        [string "boot.lua"]:612: in function <[string "boot.lua"]:594>
        [C]: in function 'xpcall'
				
				?Level.isActive("space" - false!
			+не добавился?
		+ожидалось что игрок удалится из коллизии и добавится в неё
	+после прохода через портал
	
		+где они добавляются во флюкс?
	+удалять сущности из флюкса при их удалении
+entity has no collision:player


	+использовать его
		+getLevelState
	+должно вернуться с стейтом
+space level bg
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	+не должно слаться клиенту
	+первое - это добавление в уровень "player"
+двойное добавление игрока на чистом старте







				+регистрировать все добавленные сущности в entity
			+те что принадлежат текущему левелу!
		+изучаем какие сущности надо анлоадить
		+игрок не анлоаднулся
	+анлоад на клиенте
	+дополнить инфой что это переход? да не важно, пусть на любом фулл стейт будет релоад
+ServerService.sendFullState(player)
		code:
			enter portal on server: Player.gotoLevel
			processing portal on client: entity\service\client_service.lua onStateReceived
	+unload prev state
	+should receive full_state on client
+enter portal, get into another level

+persist frame number


delete collisions
	можно отложить, пусть будет 1 менеджер сущностей на все левела пока что
	entitties is a prop of level
+multilevel support
cam setWorld level size
+space level
			draw it - later
		+-debug: get collision rect on client - later, use log
		
		+update on move
			+когда сущность добавляется на левел->Entity.add
		+регить в ней сущности
		+либа
	+on server
+collision model
		collisions (check gen1)
	activated by space
	placeable in editor
	+as item
+portal
item pickup
	
	low prior
server delete players from levels on shutdown
	low prior
server pause for debug
	перестало ломать запуск, отложено
не должны move посылать пока клиент не зашел на уровень




	для симуляции в фоне
	для отладки сервера
+возможность прогружать мир на сервере без клиента


		+level_name to entity
	+handle
	+sim update event
seed should grow

	+do not run all at once, iterate em
+optimize ai
+camera zoom+-

	where it needed?
add level_name to entities for convenience
	
	log draw order - make sure its the reason of flicker
consistent draw sort (flickering now)


+warn:logging player which already on level
 
				+on game_start
			+activate/deactivate level
		+add entities on server
	+ai
	+to editor
+add panther
	

				+on first activation
			+query from server
		+define placeable items
			+seed should have sprite
		+draw active item
			+some entities could listen for keys
		+enable/disable by F11

			+entity react to mouse click
		+place by rclick
	+editor mode
+put seed into world
	+list_players_response - empty
	+сбросились коорд
+persist server
		+если игрок уже находится на уровне - не добавлять его повторно
	+если клиент падает то при повторном входе он ложит сервер
	+login into title
	
		+шлём уведомление всем кроме входящего
	+при входе второго игрока первый это не видит
+dual player test

+выход из игры при логоффе

+при втором логоффе сервер пытался удалить игрока с ид 1 хотя был создан с ид 2

	+если нету первого - команда на создать как раньше
	+логинимся первым из списка
	+сервером отдаём игрока
	+запрашиваем список
+нужно на логине заходить тем же игроком с ид=1
				
				+dont skip it on client
				+by removing from local state
			+handle entity_removed
				+make sure it sent
				+log all received
			+receive entity_removed on client
			+introduce event target type 'level'
		notify everyone on this level
		+remove player
			+do logoff on receive
		+send logoff ok event
	+handle logoff on server
	+send logoff event
+remove leaving player

+qol: clean start mode
	
	+draw upgraded
	+property defined
+entity draw layer property
	
	+make sure drawUi is called
	+add it to local entities
	+declare ui entity	
		reference: gen1, ui was fine. ok to paste
		then it managed by POW
		it has drawUi function
		ui component is local entity (service in current terms)
	ui fundamentals
hotbar ui













+попробовать LÖVE live coding





























client send walk intention to server
	server respond with walk command to all


+move camera to POW
+console custom title - bug with new lines
+упрощение до мгновенной обработки событий
+теперь каждое событие нужно вызывать process
+create_player_response send from server
+afterPlayerCreated react on client
+server response to game_start
	send game state+
		make first level 'start'+
			bg prop+
			objects list later+
	+send player state
	
+process full_state event on client	
	receive+
	+apply level
		+background
	+apply player position
zerobrane mod: custom bg pattern for files (know when you in lib/framework/game	



































session 2019-03-15
	events: use queue
		use deque as internal storage
		+pow: attach queue lib
			Pow.deque
				C:\Gamedev\Love\LoFiFreestyleGame\generation2\client\shared\lib\powlov\deps\cw-lua\deque\deque.lua
	
	


client respond to create_player
	вызов create_player_response
		\client\shared\lib\powlov\module\net\client.lua
		сейчас 
error:net msg not processed:{
cmd="events_client",
events={
        [1]={
                player={
                        entity="player",
                        name="mw",
                        id=4
                },
                target="login",
                code="create_player_response",
                id=4,
                entity="Event",
                targetLogin="c1"
        }
}
}#^#		

+qol: git submodules? no, freeze specific versions.

+console: give command



server sends create_player_response to client:
	should happens in 
	 error:event unprocessed:{
	player={
					entity="player",
					name="mw",
					id=2
	},
	target="login",
	code="create_player_response",
	id=2,
	entity="Event",
	targetLogin="c1"
	}
	stack traceback:
					shared/lib/powlov/deps/debug.lua:50: in function 'log'
					shared/lib/powlov/module/net/event.lua:142: in function 'doProcessEvent'
					shared/lib/powlov/module/net/event.lua:155: in function 'processEvent'
					shared/lib/powlov/module/net/event.lua:162: in function 'update'
					shared/lib/powlov/pow.lua:214: in function 'update'
					main.lua:29: in function 'update'
					[string "boot.lua"]:509: in function <[string "boot.lua"]:493>
					[C]: in function 'xpcall'
					[strin


qol: mod zbs: store mod date of each line

+no id for services

server:

на обдумывание:
	некоторые обработчики нужны только в ответ на что-то.
	вешать их динамически и когда не нужны - снимать
	


	+108179  error:event unprocessed:{
	target="server",
	code="create_player",
	id=12,
	entity="Event",
	player_name="mw",
	login="c1"
	}
	stack traceback:
					shared/lib/powlov/deps/debug.lua:50: in function 'log'
					shared/lib/powlov/module/net/event.lua:141: in function 'doProcessEvent'
					shared/lib/powlov/module/net/event.lua:154: in function 'processEvent'
					shared/lib/powlov/module/net/event.lua:161: in function 'update'
					shared/lib/powlov/pow.lua:214: in function 'update'
					main.lua:22: in function 'update'
					[string "boot.lua"]:509: in function <[string "boot.lua"]:493>
					[C]: in function 'xpcall'
					[string "boot.lua"]:657: in function <[string "boot.lua"]:630>

+client: event without code


	812     entity:unload_state. level:start
	812     unload:player id:4 xy:71.96890821683,101.75
				_all проходит
			второй раз по анлоад стейта на новом стейте - тут не должен
			
	812     onEntityRemoved:{
		code = "entity_removed",
		entity_name = "Event",
		entityRef = {
			entity_name = "player",
			id = 4,
			level_name = "start"
		},
		id = 48,
		level = "start",
		target = "level"
	}		
			первый раз по портальному ремуву
		2 раза unload игрока запрошен
			пока что морочно, просто на клиенте игнорим
		да не надо себе же слать, мы ещё не на новом уровне, себя с полным стейтом получим
		затем оно же onEntityAdded
		первый раз удаляется по событию с сервера

+18047   error: removeDrawable failed. Entity was not in drawables:player id:1 xy:97.75,4.75



	+try https://github.com/jumpsplat120/Console
+qol: ingame console
	
				+think those handlers generic way - later
			+it wont. implement single response handler on client
		+test afterLogin hit
	+on successfull login send request
	
	
	
	
	
	

	server reacts to create_player
client joins world p2

					+respond login_ok with login
				+должно заполниться после 
				+event.login=_netState.login не заполнено
				+событие без логина
			+shouldSendEventFromClient:1 t:server c:create_player targetLogin:nil result:false - it  should
			+пусть сервер и клиент это делают
		+что должно отправить событие? хранятся в pow.net.event
	+send create event  to server
		+create_player
	+create event for server
+client joins world p1


	+test receive
+client ack of login success	
+server responds to login command with 
+client connects



multipart entity (s+c+sha)

+Server start listening

	+pick net lib
		grease - picked
			pro
				known
			con
				too lowlevel, need boilerplate code/midware
					but could be good experience, no extra/unused code
					and better understanding
			
		noobhub - rejected
			pro
				noivelty
				can save time
			con
				js, not lua!
				
enforce strict later
				
				
plugin architecture
	api
		game itself as api? seems fine
		or short set of methods?


ingame dreams, playable )


ingame landscape paint

-- far idea bucket
	war time survival, based on real stories
	


Concept
	private
	protected
	mystery
	rethink everything, totally new iteration
	no text in core, plugins only
	
	
	
go underground. prvate rep	